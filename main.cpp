
#include <WinSock2.h>
#include <WS2tcpip.h>
#include <Windows.h>
#include <string>
#include <iostream>
#include <wininet.h>
#include <fstream>
#include <thread>
#include <vector>

#pragma comment(lib, "wininet.lib")
#pragma comment(lib, "Ws2_32.lib")

using namespace std;

void KimJongPrint();
int ContactIpAddresses(string ip_addr, string port);

size_t write_data(void* buffer, size_t size, size_t nmemb, void* userp) {
	std::ofstream* file = static_cast<std::ofstream*>(userp);
	file->write(static_cast<char*>(buffer), size * nmemb);
	return size * nmemb;
}

int ContactIpAddresses(string ip_addr, string port) {
	
	WSADATA wsaData;
	int ret = WSAStartup(MAKEWORD(2, 2), &wsaData);
	SOCKET sockfd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);

	struct addrinfo* result = NULL, hints;
	ZeroMemory(&hints, sizeof(hints));
	hints.ai_family = AF_INET;
	hints.ai_socktype = SOCK_STREAM;
	hints.ai_protocol = IPPROTO_TCP;

	ret = getaddrinfo(ip_addr.c_str(), port.c_str(), &hints, &result);
	ret = connect(sockfd, result->ai_addr, (int)result->ai_addrlen);

	freeaddrinfo(result);
	closesocket(sockfd);
	WSACleanup();

	return 0;
}


int main() {

	const int nbr_thds = 200;
	thread threads[nbr_thds];
	vector<string> ip_addrs;

	for (int i = 0; i < 200; i++) {
		string ip_addr_beg = "175.45.176.";
		ip_addr_beg.append(to_string(i));
		ip_addrs.push_back(ip_addr_beg);
	}

	for (int i = 0; i < 200; i++) {
		threads[i] = thread(ContactIpAddresses, ip_addrs[i], to_string(7777));
	}

	for (int i = 0; i < 200; i++) {
		threads[i].join();
	}

	HINTERNET hInternet = InternetOpen(TEXT("WinINet Example"), INTERNET_OPEN_TYPE_DIRECT, NULL, NULL, 0);
	if (hInternet == NULL) {
		std::cerr << "Error: InternetOpen failed, code " << GetLastError() << std::endl;
		return 1;
	}

	HINTERNET hUrl = InternetOpenUrl(hInternet, TEXT("https://asialyst.com/fr/wp-content/uploads/2018/06/Couverture-La-Piste-Kim-Sebastien-Falletti.jpg"), NULL, 0, INTERNET_FLAG_RELOAD | INTERNET_FLAG_DONT_CACHE, 0);
	if (hUrl == NULL) {
		std::cerr << "Error: InternetOpenUrl failed, code " << GetLastError() << std::endl;
		InternetCloseHandle(hInternet);
		return 1;
	}

	std::ofstream outfile("image.jpg", std::ios::binary);

	char buffer[1024];
	DWORD bytesRead;
	do {
		if (!InternetReadFile(hUrl, buffer, sizeof(buffer), &bytesRead)) {
			std::cerr << "Error: InternetReadFile failed, code " << GetLastError() << std::endl;
			InternetCloseHandle(hUrl);
			InternetCloseHandle(hInternet);
			outfile.close();
			return 1;
		}
		outfile.write(buffer, bytesRead);
	} while (bytesRead > 0);

	outfile.close();
	InternetCloseHandle(hUrl);
	InternetCloseHandle(hInternet);

	std::cout << "Image downloaded successfully" << std::endl;

	system("color 4f");
	KimJongPrint();

	//const wchar_t* path = L"\\image.jpg";
	const wchar_t* path = L"C:\\Users\\1234Y\\source\\repos\\kimjongundostres\\kimjongundostres\\image.jpg";


	int res = SystemParametersInfoW(SPI_SETDESKWALLPAPER, 0, (void*)path, SPIF_UPDATEINIFILE);
	cout << res << endl;
	/* --------------------- EVENTS SIMULATION --------------------- */

	// Create or open the event with ID 4698
	HANDLE hEvent = CreateEvent(NULL, FALSE, FALSE, L"MyEvent4698");

	if (hEvent == NULL) {
		cout << "Error !" << endl;
		return -2;
	}

	// Inject data into the system log using ReportEvent function
	HANDLE hLog = RegisterEventSource(NULL, L"Application");

	if (hLog != NULL)
	{
		std::wstring message = L"Data to be injected into the log";
		LPCWSTR strings[1] = { message.c_str() };
		ReportEvent(hLog, EVENTLOG_INFORMATION_TYPE, 0, 4698, NULL, 1, 0, strings, NULL);
		DeregisterEventSource(hLog);
	}

	SetEvent(hEvent);

	CloseHandle(hEvent);

	return 0;
}


void KimJongPrint() {

	std::cout << R"(

UN DOS TRES UN DOS TRES UN PASITO PALANTE MARIA

              uu$:$:$:$:$:$uu
          uu$$$$$$$$$$$$$$$$$uu
         u$$$$$$$$$$$$$$$$$$$$$u
         u$$$$$$$$$$$$$$$$$$$$$$$u
       u$$$$$$$$$$$$$$$$$$$$$$$$$u
       u$$$$$$$$$$$$$$$$$$$$$$$$$u
       u$$$$$$*   *$$$*   *$$$$$$u
       *$$$$*      u$u       $$$$*
        $$$u       u$u       u$$$
        $$$u      u$$$u      u$$$
         *$$$$uu$$$   $$$uu$$$$*
          *$$$$$$$*   *$$$$$$$*
            u$$$$$$$u$$$$$$$u
             u$*$*$*$*$*$*$u
  uuu        $$u$ $ $ $ $u$$       uuu
 u$$$$        $$u$u$u$u$u$$       u$$$$
  $$$$$uu      *$$$$$$$$$*     uu$$$$$$
u$$$$$$$$$$$      *****    uuuu$$$$$$$$$
$$$$***$$$$$$$$$$uuu   uu$$$$$$$$$***$$$*
 ***      **$$$$$$$$$$$uu **$***
          uuuu **$$$$$$$$$$uuu
 u$$$uuu$$$$$$$$$uu **$$$$$$$$$$$uuu$$$
 $$$$$$$$$$****           **$$$$$$$$$$$*
   *$$$$$*                      **$$$$**
     $$$*     PRESS ANY KEY!      $$$$*
	

NORTH KOREA GOT YOUUUUUUUU - XOXO KIMJONUNDOSTRESQUATROCINCO

)";

}
